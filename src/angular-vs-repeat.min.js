//
// Copyright Kamil PÄ™kala http://github.com/kamilkp
// Angular Virtual Scroll Repeat v1.0.0-rc12 2015/08/03
//
!function(a,b){"use strict";function c(){if("pageYOffset"in a)return{scrollTop:pageYOffset,scrollLeft:pageXOffset};var b,c,d=document,e=d.documentElement,f=d.body;return b=e.scrollLeft||f.scrollLeft||0,c=e.scrollTop||f.scrollTop||0,{scrollTop:c,scrollLeft:b}}function d(b,c){return b===a?"clientWidth"===c?a.innerWidth:a.innerHeight:b[c]}function e(b,d){return b===a?c()[d]:b[d]}function f(b,d,e){var f=b.getBoundingClientRect()[e?"left":"top"],g=d===a?0:d.getBoundingClientRect()[e?"left":"top"],h=f-g+(d===a?c():d)[e?"scrollLeft":"scrollTop"];return h}var g=-1!=navigator.appVersion.indexOf("Mac"),h="undefined"!=typeof a.onwheel?"wheel":"undefined"!=typeof a.onmousewheel?"mousewheel":"DOMMouseScroll",i=document.documentElement,j=i.matches?"matches":i.matchesSelector?"matchesSelector":i.webkitMatches?"webkitMatches":i.webkitMatchesSelector?"webkitMatchesSelector":i.msMatches?"msMatches":i.msMatchesSelector?"msMatchesSelector":i.mozMatches?"mozMatches":i.mozMatchesSelector?"mozMatchesSelector":null,k=b.element.prototype.closest||function(a){for(var c=this[0].parentNode;c!==document.documentElement&&null!=c&&!c[j](a);)c=c.parentNode;return c&&c[j](a)?b.element(c):b.element()},l=b.module("vs-repeat",[]).directive("vsRepeat",["$compile",function(c){return{restrict:"A",scope:!0,require:"?^vsRepeat",controller:["$scope",function(a){this.$scrollParent=a.$scrollParent,this.$fillElement=a.$fillElement}],compile:function(i){var j=i.children().eq(0),l=j.attr("ng-repeat")||j.attr("data-ng-repeat"),m=j[0].outerHTML,n=/^\s*(\S+)\s+in\s+([\S\s]+?)(track\s+by\s+\S+)?$/.exec(l),o=n[1],p=n[2],q=n[3],r="$vs_collection",s={vsRepeat:"elementSize",vsOffsetBefore:"offsetBefore",vsOffsetAfter:"offsetAfter",vsExcess:"excess"};return i.empty(),a.getComputedStyle&&"absolute"===a.getComputedStyle(i[0]).position||i.css("position","relative"),{pre:function(i,j,l,n){function t(a,c){if(!G||G.length<1)return i[r]=[],C=0,y(0),void(i.sizesCumulative=[0]);if(C=G.length,J){i.sizes=G.map(function(a){var c=i.$new(!1);b.extend(c,a),c[o]=a;var d=l.vsSize||l.vsSizeProperty?c.$eval(l.vsSize||l.vsSizeProperty):i.elementSize;return c.$destroy(),d});var d=0;i.sizesCumulative=i.sizes.map(function(a){var b=d;return d+=a,b}),i.sizesCumulative.push(d)}else u();x(c)}function u(){I&&i.$$postDigest(function(){if(j[0].offsetHeight||j[0].offsetWidth)for(var a=j.children(),b=0;b<a.length;){if(null!=a[b].attributes["ng-repeat"]||null!=a[b].attributes["data-ng-repeat"]){a[b][P]&&(i.elementSize=a[b][P],x(),I=!1,i.$root&&!i.$root.$$phase&&i.$apply());break}b++}else var c=i.$watch(function(){(j[0].offsetHeight||j[0].offsetWidth)&&(c(),u())})})}function v(a){var b=a.currentTarget;(b.scrollWidth>b.clientWidth||b.scrollHeight>b.clientHeight)&&D.css("display","block")}function w(){"undefined"!=typeof l.vsAutoresize&&(I=!0,u(),i.$root&&!i.$root.$$phase&&i.$apply()),B()&&(i.$apply(),i.$broadcast("vsSetOffset-refresh"))}function x(a){T=void 0,U=void 0,V=C,W=0,B(a),y(J?i.sizesCumulative[C]:i.elementSize*C),i.$evalAsync(function(){i.$broadcast("vsSetOffset-refresh")}),i.$emit("vsRepeatReinitialized",i.startIndex,i.endIndex)}function y(a){if(H){if(E.css({width:i.offsetBefore+a+i.offsetAfter+"px",height:"100%"}),n&&n.$fillElement){var b=n.$fillElement[0].parentNode.querySelector("[ng-repeat]");b&&n.$fillElement.css({width:b.scrollWidth+"px"})}}else E.css({height:i.offsetBefore+a+i.offsetAfter+"px",width:"100%"}),n&&n.$fillElement&&(b=n.$fillElement[0].parentNode.querySelector("[ng-repeat]"),b&&n.$fillElement.css({height:b.scrollHeight+"px"}))}function z(){var a=d(K[0],O);a!==X&&(x(),i.$root&&!i.$root.$$phase&&(i.$apply(),i.$broadcast("vsSetOffset-refresh"))),X=a}function A(a){var b=!1;return void 0!==a&&"number"==typeof a&&(b=Math.max(a,0),K[0][Q]!==b?(K[0][Q]=b,M=!0):b=!1,i.$emit("vsRepeatScrolled",b)),b}function B(a){var b,c,g,h,k=e(K[0],Q),l=d(K[0],O),m=j[0]===K[0]?0:f(j[0],K[0],H),n=!0,o=i.startIndex,p=i.endIndex;if(a&&void 0!==a.elementSize&&(i.elementSize=a.elementSize),a&&void 0!==a.scrollIndex){if("undefined"!=typeof i.scrollSettings&&(i.scrollSettings.scrollIndex=a.scrollIndex),J?(h=i.sizes[a.scrollIndex],g=i.sizesCumulative[a.scrollIndex]):(h=i.elementSize,g=a.scrollIndex*i.elementSize),void 0!==a.scrollIndexPosition)switch("undefined"!=typeof i.scrollSettings&&(i.scrollSettings.scrollIndexPosition=a.scrollIndexPosition),b=0,typeof a.scrollIndexPosition){case"number":b=a.scrollIndexPosition+i.offsetBefore;break;case"string":switch(a.scrollIndexPosition){case"top":b=i.offsetBefore;break;case"middle":b=(l-h)/2;break;case"bottom":b=l-h-i.offsetAfter;break;case"inview":case"inview#top":case"inview#middle":case"inview#bottom":case"inview#auto":K[0][Q]<=g&&K[0][Q]+l-h>=g?(n=!1,b=g-K[0][Q]):(("inview#top"===a.scrollIndexPosition||"inview"===a.scrollIndexPosition)&&(b=i.offsetBefore),"inview#bottom"===a.scrollIndexPosition&&(b=l-h+i.offsetAfter),"inview#middle"===a.scrollIndexPosition&&(b=(l-h)/2),"inview#auto"===a.scrollIndexPosition&&(b=K[0][Q]<=g?l-h+i.offsetAfter:i.offsetBefore));break;default:console.warn("Incorrect scrollIndexPosition string value")}break;default:console.warn("Incorrect scrollIndexPosition type")}else n=!1,b=J?i.sizesCumulative[a.scrollIndex]-K[0][Q]:a.scrollIndex*i.elementSize-K[0][Q];if(o=a.scrollIndex,J){for(;i.sizesCumulative[o]>i.sizesCumulative[a.scrollIndex]-b;)o--;for(c=Math.max(o,0),o=Math.max(Math.floor(o-i.excess/2),0),p=o;i.sizesCumulative[p]<i.sizesCumulative[c]-i.offsetBefore+l;)p++;p=Math.min(Math.ceil(p+i.excess/2),C)}else{for(;o*i.elementSize>a.scrollIndex*i.elementSize-b;)o--;c=Math.max(o,0),o=Math.max(Math.floor(o-i.excess/2),0),p=Math.min(o+Math.ceil(l/i.elementSize)+i.excess/2,C)}}else if(J){for(o=0;i.sizesCumulative[o]<k-i.offsetBefore-m;)o++;for(o>0&&o--,o=Math.max(Math.floor(o-i.excess/2),0),p=o;i.sizesCumulative[p]<k-i.offsetBefore-m+l;)p++;p=Math.min(Math.ceil(p+i.excess/2),C)}else o=Math.max(Math.floor((k-i.offsetBefore-m)/i.elementSize)-i.excess/2,0),p=Math.min(o+Math.ceil(l/i.elementSize)+i.excess,C);V=Math.min(o,V),W=Math.max(p,W),i.startIndex=N.latch?V:o,i.endIndex=N.latch?W:p,void 0!==a&&void 0!==a.scrollIndex&&void 0!==b&&n&&A(g-b);var q=!1;return null==T?q=!0:null==U&&(q=!0),q||(N.hunked?Math.abs(i.startIndex-T)>=i.excess/2||0===i.startIndex&&0!==T?q=!0:(Math.abs(i.endIndex-U)>=i.excess/2||i.endIndex===C&&U!==C)&&(q=!0):q=i.startIndex!==T||i.endIndex!==U),q&&(i[r]=G.slice(i.startIndex,i.endIndex),i.$emit("vsRepeatInnerCollectionUpdated",i.startIndex,i.endIndex,T,U),T=i.startIndex,U=i.endIndex),q}var C,D,E,F=b.element(m),G=[],H="undefined"!=typeof l.vsHorizontal,I=!l.vsRepeat,J=!!l.vsSize||!!l.vsSizeProperty,K=l.vsScrollParent?"window"===l.vsScrollParent?b.element(a):k.call(j,l.vsScrollParent):j,L=H?"left":"top",M=!1,N="vsOptions"in l?i.$eval(l.vsOptions):{},O=H?"clientWidth":"clientHeight",P=H?"offsetWidth":"offsetHeight",Q=H?"scrollLeft":"scrollTop";if(!("vsSize"in l)&&"vsSizeProperty"in l&&console.warn("vs-size-property attribute is deprecated. Please use vs-size attrubute which also accepts angular expressions."),0===K.length)throw"Specified scroll parent selector did not match any element";i.$scrollParent=K,J&&(i.sizesCumulative=[]),i.elementSize=+l.vsRepeat||d(K[0],O)||50,i.offsetBefore=0,i.offsetAfter=0,i.excess=2,i.scrollSettings={scrollIndex:0,scrollIndexPosition:"top"},i.$watch(l.vsScrollSettings,function(a){"undefined"!=typeof a&&(i.scrollSettings=a,x(i.scrollSettings))},!0),Object.keys(s).forEach(function(a){l[a]&&l.$observe(a,function(b){i[s[a]]=+b,x()})}),i.$watchCollection(p,function(a){G=a||[],t()}),F.attr("ng-repeat",o+" in "+r+(q?" "+q:"")).addClass("vs-repeat-repeated-element");var R=J?"(sizesCumulative[$index + startIndex] + offsetBefore)":"(($index + startIndex) * elementSize + offsetBefore)";F.attr("vs-set-offset",R),F.attr("vs-set-offset-positioning-property",L),c(F)(i),j.append(F),E=b.element('<div class="vs-repeat-fill-element"></div>').css({position:"relative","min-height":"100%","min-width":"100%"}),j.append(E),c(E)(i),i.$fillElement=E;var S={};g&&"window"!==l.vsScrollParent&&(D=b.element('<div class="vs-repeat-wheel-helper"></div>').on(h,function(a){a.preventDefault(),a.stopPropagation(),a.originalEvent&&(a=a.originalEvent),K[0].scrollLeft+=a.deltaX||-a.wheelDeltaX,K[0].scrollTop+=a.deltaY||-a.wheelDeltaY}).on("mousemove",function(a){(S.x!==a.clientX||S.y!==a.clientY)&&b.element(this).css("display","none"),S={x:a.clientX,y:a.clientY}}).css("display","none"),E.append(D)),i.startIndex=0,i.endIndex=0,K.on("scroll",function(){M?M=!1:B()&&(i.$apply(),i.$broadcast("vsSetOffset-refresh"))}),g&&K.on(h,v),b.element(a).on("resize",w),i.$on("$destroy",function(){b.element(a).off("resize",w)}),i.$on("vsRepeatTrigger",t),i.$on("vsRepeatResize",function(){I=!0,u()});var T,U,V,W;i.$on("vsRenderAll",function(){N.latch&&setTimeout(function(){var a=C;W=Math.max(a,W),i.endIndex=N.latch?W:a,i[r]=G.slice(i.startIndex,i.endIndex),U=i.endIndex,i.$apply(function(){i.$emit("vsRenderAllDone")})})});var X;i.$watch(function(){"function"==typeof a.requestAnimationFrame?a.requestAnimationFrame(z):z()})}}}}}]).directive("vsSetOffset",[function(){return function(a,b,c){function d(){b.css(e,a.$eval(c.vsSetOffset)+"px")}var e=c.vsSetOffsetPositioningProperty;d(),a.$on("vsSetOffset-refresh",d)}}]);b.element(document.head).append(["<style>.vs-repeat-wheel-helper{position: absolute;top: 0;bottom: 0;left: 0;right: 0;z-index: 99999;background: rgba(0, 0, 0, 0);}.vs-repeat-repeated-element{position: absolute;z-index: 1;}</style>"].join("")),"undefined"!=typeof module&&module.exports&&(module.exports=l.name)}(window,window.angular);